# Becoming Functional - Several Questions

# 第一章 函数式编程起步——若干问题 



函数式编程（或 `FP`）早在计算机时代初期就已经诞生了。由于它越来越多地应用于多个框架和工具库，尤其是 `JavaScript`（`JS`） 相关领域，函数式编程正经历着某种意义上的复兴。本章主要内容有：

1. 通过介绍函数式编程的相关概念，对其有一个初步认识；
2. 介绍函数式编程在使用过程中的好处与问题，以及为什么要使用它；
3. 考察 `JavaScript` 被视为一门适于进行函数式编程的语言的原因；
4. 回顾必要的语言特性与常用工具，以全面掌握本书各知识点。

学完本章，您将习得本书后续部分会用到的基本工具。首先来了解一下函数式编程。



## 1. 何谓函数式编程？What is functional programming?

回顾一下计算机发展史，你会发现仍在使用的第二古老的编程语言 `Lisp`，就是以函数式编程为基础的。此后，函数式语言层出不穷，函数式编程的应用也更加广泛。但即便如此，如果问大家什么是函数式编程，你可能会得到两类截然不同的回答。

> 小知识
>
> 对于喜欢打破砂锅问到底的人或爱好历史掌故的发烧友而言，目前仍在使用的最古老的语言是 `Fortran`，它出现于 1957 年，比 `Lisp` 早一年。 在 `Lisp` 之后不久，出现了另一种长期存在的语言 `COBOL`，用于面向业务的编程。

取决于你询问的人，你要么听到这样的回答：函数式编程是一种现代的、先进的、开明的编程手法，其他编程范式在它面前都会黯然失色；要么听到另一种声音：函数式编程基本上还是一个理论上的东西，其复杂程度超过带来的好处，在现实世界中几乎不可能实现。实际上真正的答案，同以往一样，并不是走极端，而是介于这两者之间。 我们不妨从理论与实践的对比出发，看看应该如何使用函数式编程。



### 1.1. 理论与实践 Theory versus practice

本书不会对函数式编程作理论上的深入探讨，而是重点展示如何将函数式编程的一些技术和原则成功应用于日常的 `JavaScript` 编程中。本书也不会教条式地行文，而是从实用的角度展开话题。我们既不会因为某些有用的 `JavaScript` 结构不符合函数式编程的学术要求而绕开它们，也不会仅仅为了迎合函数式的编程范式而避开一些实用的 `JavaScript` 特性。事实上，本书毋宁说是在介绍类函数式编程（`SFP`, **S**orta **F**unctional **P**rogramming），因为书中的代码将会是函数式编程特性、更为经典的命令式编程、以及面向对象编程（OOP）三者的结合体。

即便如此，本书也并非将所有的理论知识都搁置一旁。 书中会有侧重地论述函数式编程的主要观点，介绍一些相关术语和基本定义，并对函数式编程的核心概念作重点阐释。我们将始终本着产出务实高效的 `JavaScript` 代码的初衷，而不是一味追求一些晦涩难懂的、教条式的函数式编程规范。

在编写大型程序和系统、以及开发干净可扩展的应用程序架构过程中，面向对象编程已经成为应对其固有复杂度的一种解决方案；一方面，随着当今 `Web` 应用程序的持续扩展，所有项目代码的复杂度都在不断增加。另一方面，`JavaScript` 的新特性使得几年前甚至不可能实现的应用程序开发成为了可能：例如使用 `Ionic`、`Apache Cordova` 或 `React Native` 制作的移动端（混合端）应用程序，或使用 `Electron` 或 `NW.js` 制作的桌面应用程序。时至今日，`JavaScript` 已经通过 `Node.js` 涉足后端开发，该语言的使用范围正以一种严肃的方式不断扩大，以应对现代设计带来的复杂性。



### 1.2. 换一种方式思考 A different way of thinking

函数式编程是另一种编程方式，学起来可能还会比较吃力。在大多数语言中，编程往往是以命令式的方式进行的。程序是一系列以规定方式执行的语句，通过创建对象并操作它们来实现预期的结果，这通常意味着修改对象本身。而函数式编程则是基于特定的表达式求值来得到想要的结果。这些表达式由组合在一起的函数构建而成。在函数式编程中，常见的操作有传递函数（比如将函数作为另一个函数的参数传入，或者将一个函数作为原函数的计算结果返回）、不使用循环（而用递归替换）、以及跳过副作用（修改对象或全局变量本身）等等。

换言之，函数式编程聚焦的是该做什么事，而非怎样做事。你无需担心循环和数组的问题，而是在更高层面上考虑需要完成的事情。一旦习惯了这种风格，你的代码将变得更简洁优雅，并且可以轻松测试与调试。 但也不要落入以函数式编程为终极目标的陷阱！与其他软件工具一样，将函数式编程视为解决问题的一种手段即可。函数式风格的代码未必就是好代码，正如任何技术一样，用函数式编程写出糟糕的代码也是可能的！





### 1.3. 函数式编程不是什么 What FP is not

前面介绍了函数式编程是什么，这里有必要澄清一些常见的误区，看看函数式编程不是什么。

- **函数式编程不是形而上学的产物**：诚然，由 *Alonzo Church* 于 1936 年提出的 **lambda 算子** 确实是证明理论计算机科学（比现代计算机语言的出现早 20 多年）的重要成果的工具，并且函数式编程也以此为基础；然而如今的函数式编程语言已经在各种系统遍地开花；
- **函数式编程不是面向对象编程的对立面**：声明式与命令式风格不是非得二选一，也可以根据喜好进行混搭，就像本书中即将论述的那样，将所有的最佳实践结合到一起。
- **函数式编程学起来并不复杂**：一些函数式编程语言与 `JavaScript` 有很大不同，但差异主要体现在语法层面。一旦了解了基本概念，您就会发现在 `JavaScript` 中也能得出函数式编程语言中相同的结果。





## 2. 为何使用函数式编程？Why use FP?

多年来，众多编程风格和时尚层出不穷。然而，函数式编程已被证明具有很强的适应性，并且在今天引起了广泛关注。为什么要使用函数式编程？或者换个问法，首先是你想得到什么？再者，函数式编程能满足要求吗？后面各节将回答这些重要的问题。

### 2.1. 我们需要什么

我们应该认同以下关注点是普遍存在的。代码应该具有以下特征：

- **模块化**：程序功能应该被切分成独立的模块，各个模块负责相应某方面的功能。模块或功能的变动不应该影响其余模块代码；
- **易理解**：阅读代码的人要能毫不费力地辨别出组件、对应的功能及其相互关系。这与代码的可维护性息息相关。你的代码可能会在今后的某个节点进行维护，无论是直接修改还是添加新功能。
- **可测试（单元测试）**：在模块上进行单元测试，验证其功能独立于其他模块。所采用的编程风格应该有助于简化单元测试。单元测试也应该像文档那样设计，以便阅读代码的人理解这段代码实现的功能。
- **可扩展**：事实上，程序总会需要维护的，比如添加新功能。这些改动对原来的数据结构和数据流造成的影响应该尽可能小（如果有的话）。小改动不应该引发代码的大规模重构。
- **可重用**：代码重用旨在节省资源、时间、金钱，通过利用之前写过的代码减少冗余。一些特性有助于实现这一目标，比如模块化（如上所述），高内聚（模块的所有部分都在一起），低耦合（模块间相互独立），焦点分离（程序在功能层面要尽可能少的出现重叠）以及信息隐藏（模块中的内部更改不应影响系统的其余部分）

### 2.2. 我们能得到什么

那么，函数式编程能否实现上面提到的五个特征呢？

- 函数式编程的目标，是分别编写相互独立的函数，再将这些函数联系到一起得出最终结果；
- 采用函数式风格编写的程序通常更简洁、更简短、更易于理解；
- 函数本就能自行测试，函数式编程产出的代码在这方面有天然优势；
- 由于相互独立，在不依赖系统其他部分的情况下，其他程序中的函数可被直接重用。大多数函数式程序共享通用函数，本书将从中挑选一些进行论述。
- 函数式的代码没有副作用（`side effects`），这意味着研究一个函数要实现的最终目的时无需考虑程序的其他部分。

最后，一旦习惯了函数式编程的风格，代码将变得更易于理解与扩展。因此函数式编程看起来完全可以实现上面提到的五个特征。

> **小知识**
>
> 为了全面了解使用函数式编程的原因，建议阅读 **John Hughes** 撰写的 ***Why Functional Programming Matters***； 详见在线资源 www.cs.kent.ac.uk/people/staff/dat/miranda/whyfp90.pdf。 虽然不是面向 `JavaScript` 讲的，但相关参数很容易理解。



### 2.3. 函数式编程并非万能钥匙

但是辩证来看的话，函数式编程并不是万能钥匙，可以自动将代码变得更好。一些函数式的解决方案实际上很棘手。某些开发人员非常喜欢编写代码，然后提问：这一段是干啥的？稍不留神，代码就可能“仅仅只是写出来了”，根本无法维护，更别提易于理解、便于扩展或者可重用什么的了。

函数式编程的另一个不足在于，精通此道的开发人员寥寥无几（你见过多少为函数式编程风格的程序员量身打造的招聘信息？）。当前绝大多数的网络代码都是命令式的、非函数式的，而且绝大多数程序员也都习惯了这种工作方式。对于某些人来说，强制换用新轮子、以另一种风格来编程可能是一个无法逾越的障碍。

最后，如果想在 `JavaScript` 中完全运用函数式编程思想，可能将会举步维艰，原来简单的任务可能会难以完成。正如前面提到过的，本书将采用类函数式（`sorta FP`）的方式，因此不会摒弃纯函数式编程以外的语言特性。毕竟，我们想用函数式编程来简化编码，而不是简单的事情复杂化！

因此，尽管笔者会努力演示函数式编程在代码实现过程中的诸多优势，但与任何更改一样，总会遇到一些困难。但我完全相信读者能够克服它们；也坚信您的组织在实践函数式编程后会开发出更好的代码。勇于改变吧！假设采用函数式风格编程适用于你当下的应用场景，接下来要考虑另一个问题是：将函数式编程风格引入 `JavaScript` 真的合适吗？



## 3. JavaScript 是函数式编程语言吗？Is JavaScript functional?

差不多是时候弄明白另一个重要问题了：`JavaScript` 是函数式语言吗？通常，`JavaScript` 都不会出现在函数式编程语音的清单里。列入清单的都是些不怎么常见的语言，例如 `Clojure`、`Erlang`、`Haskell` 和 `Scala`；但函数式编程语言并没有一个准确的定义，也没有该语言所特有的功能特性的精确描述。最主要的是，如果一种语言支持与函数式编程相关的通用编程风格，就可以认为是函数式编程语言。让我们首先来了解一下为什么要使用 `JavaScript`，看看该语言是如何发展到其当前版本的，然后再来了解用 JavaScript 进行函数式编程的一些关键特性。



### 3.1. 作为一种工具

`JavaScript` 是什么样的语言呢？就流行指数而言，正如在 www.tiobe.com/tiobe-index/ 或 http://pypl.github.io/PYPL.html 上看到的一样，`JavaScript` 一直是最受欢迎的十大语言之一。从更偏学术的角度来看，`JavaScript` 更像一个从多种不同语言借用了相关特性所构成的综合体。一些库通过提供不太容易获得的特性来帮助该语言发展，例如类（`class`）和继承（`inheritance`）（目前的版本的确支持类，不久前情况并非如此），否则必须从 **原型** 上取巧实现。

> **小知识**
>
> 当年选择 `JavaScript` 这个名字是为了蹭 `Java` 语言的热度——出于营销的目的。其最早的名字叫 `Mocha`，然后又叫 `LiveScript`，最后才叫 `JavaScript`

现如今 `JavaScript` 已经变得非常强大了。但是与所有强大的工具一样，在提供出色的解决方案的同时，也可能带来巨大的危害。函数式编程或许能够减少或避开该语言中一些最糟糕的部分，以一种更安全、更好的方式工作；然而，由于现有的 `JavaScript` 代码量巨大，要是指望它来推动 `JavaScript` 代码 —— 这种可能导致绝大多数网站失效的语言 —— 进行大规模重构，最终也是痴人说梦。无论好坏都得去学习了解，然后再扬长避短。

此外，`JavaScript` 还拥有大量现成的第三方库，以多种方式丰富并拓展了该语言的适用范围。本书将围绕 `JavaScript` 本身，引用现成代码进行论述讲解。

至于 `JavaScript` 是否是实际意义上的函数式编程语言，答案仍旧是：类似。因为 `JavaScript` 具备的几个特性，例如一等公民函数、匿名函数、递归和闭包（稍后会有论述），它可以被视为是函数式的编程语言；但另一方面，它也有一些非函数式风格的特点，例如副作用（不纯性（`impurity`））、可变对象和受限的递归。因此，采用函数式方式编程时，既要利用好 `JavaScript` 所有相关的、恰当的语言特性，也要尽量减少由语言本身引入的问题。从这个意义上说，`JavaScript` 是不是函数式的语言，取决于所采用的编程风格。

要使用函数式编程，应该决定选用哪种语言；然而，一味选择纯函数式语言未必就是明智之举。如今写代码并不仅仅是使用一种编程语言那么简单，还得有框架、库和其他各种工具的支撑。如果能在利用好现有工具的同时，在代码中恰当地引入函数式的编程风格，这样双管齐下，`JavaScript` 是否是函数式编程语言，已经不重要了。



### 3.2. 实现函数式编程





### 3.3. 关键语言特性





## 4. 怎样使用 JavaScript？How do we work with JavaScript?





## 5. 小结 Summary





## 6. 问题 Questions







