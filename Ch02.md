# Thinking Functionally - A First Example

# 第二章 函数式地思考问题——第一个案例



第一章我们回顾了函数式编程是什么、论述了应用函数式编程的一些优点、并介绍了使用 `JavaScript` 过程中需要的一些工具。现在让我们抛开理论，从一个简单的问题入手，看看怎样用函数式编程的方式来解决问题。

本章包含如下内容：

- 考察一个简单又常见的电子商务方面的问题
- 采用几个常见的处理方式来解决这个问题，并考察这些方法存在的缺陷
- 从函数式编程的角度，找出一个方法来解决该问题
- 设计一个可应用于其他问题的高阶解决方案
- 研究如何对函数式的解决方案进行单元测试

由于后续章节会深入论述这里列出的一些主题，因此这里不详细展开。本章只展示函数式编程如何围绕具体的问题提供不同的视角，具体细节留待后续介绍。本章将作为后续章节的前奏，带您考察一个具体的常见问题，并利用函数式的思维方式予以解决。



## 2.1 提出问题：某件事只干一次 Our problem – doing something only once

一起来考虑这样一个简单而常见的场景：您开发了一个电商网站，网站用户可以添加商品到购物车，最后单击结算按钮，由绑定的信用卡完成支付。此时，用户不能单击按钮两次或更多次，以免造成重复支付。

对应的 `HTML` 部分可能如下：

```html
<button id="billButton" onclick="billTheUser(some, sales, data)">Bill me</button>
```

相关的 `JavaScript` 脚本可能如下：

```js
function billTheUser(some, sales, data) {
  window.alert("Billing the user...");
  // actually bill the user
}
```

> **注意**
>
> 不推荐把事件处理函数像这样直接写到 `HTML` 中；更恰当的方式应该是在代码层面完成事件绑定。按我说的去做，别照搬我的做法。

以上是对研究的问题和网页的最简单的解释，但对于本章演示来说已经足够了。接下来需要考虑：如何避免重复单击该按钮。如何才能避免用户多次点击呢？这个有趣的问题通常有若干种可能的解决方案，先从不怎么样的方案开始吧。

您能想到几种解决方案呢？一起来看看几个可能的方案，并分析他们的解决质量。



### 1. 方案 1：抱最大的希望 Solution 1 – hoping for the best!

第一个方案听起来更像个笑话：什么也不做，只是告知用户别点第二次，然后希望他们确实能按要求这么做。页面类似酱紫：

![img](assets/2-1.png)

**图 2-1 实际页面截图，提醒用户不要单击一次以上**

显然，这是一种逃避问题的方案。笔者见过几个这样的网站，只提醒用户单击多次存在的风险（如图 2-1 所示）而不作任何改进。“重复支付了么？我提醒过了啊……那是他们自己的问题！”

采用该方案可能会看到这样的代码：

```html
<button id="billButton" onclick="billTheUser(some, sales, data)">Bill me</button>
<b>WARNING: PRESS ONLY ONCE, DO NOT PRESS AGAIN!!</b>
```

说到底，这并不算一个实际解决方案，接着来看一个更靠谱的方案。



### 2. 方案 2：使用全局变量 using a global flag



### 3. 方案 3：移除处理函数 removing the handler



### 4. 方案 4：改变处理函数 changing the handler



### 5. 方案 5：禁用按钮 disabling the button



### 6. 方案 6：重新定义处理函数 redefining the handler



### 7. 方案 7：使用局部变量 using a local flag



## 2.2 该问题的函数式解 A functional solution to our problem



### 1. 高阶函数解 A higher-order solution



### 2. 高阶函数解的手动测试 Testing the solution manually



### 3. 高阶函数解的自动测试Testing the solution manually



### 4. 更好的解决方案 Producing an even better solution





## 2.3 小结





## 2.4 思考题



